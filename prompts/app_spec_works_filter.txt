<project_specification>
  <project_name>Library RAG - Filtrage par ≈ìuvres dans la conversation</project_name>

  <overview>
    Syst√®me de filtrage par ≈ìuvres pour la page de conversation RAG, permettant aux utilisateurs de s√©lectionner les ≈ìuvres sur lesquelles effectuer la recherche s√©mantique.

    **Objectif :**
    Ajouter une section "Filtrer par ≈ìuvres" dans la sidebar droite (au-dessus du "Contexte RAG") avec des cases √† cocher pour chaque ≈ìuvre disponible. Chaque message de la conversation recherchera uniquement dans les ≈ìuvres s√©lectionn√©es.

    **Architecture :**
    - Backend : Nouvelle route API + modification de la recherche Weaviate avec filtres
    - Frontend : Nouvelle section UI avec checkboxes + JavaScript pour √©tat et persistance
    - Persistance : localStorage pour sauvegarder la s√©lection entre les sessions

    **Comportement par d√©faut :**
    - Toutes les ≈ìuvres coch√©es au d√©marrage
    - Section collapsible avec chevron
    - Boutons "Tout" / "Aucun" pour s√©lection rapide
    - Badge compteur : "X/Y s√©lectionn√©es"
    - Responsive mobile : section pliable au-dessus de l'input

    **Contraintes :**
    - Ne pas modifier l'export Word/PDF existant
    - Conserver la structure grid 60%/40% (conversation/sidebar)
    - Compatibilit√© avec les 3 modes de recherche (simple, hi√©rarchique, summary)
  </overview>

  <technology_stack>
    <backend>
      <framework>Flask 3.0+</framework>
      <database>Weaviate 1.34.4 + text2vec-transformers (BGE-M3)</database>
      <python>Python 3.10+</python>
    </backend>
    <frontend>
      <template_engine>Jinja2</template_engine>
      <javascript>Vanilla JavaScript (ES6+)</javascript>
      <css>Custom CSS (variables CSS existantes)</css>
      <storage>localStorage (Web Storage API)</storage>
    </frontend>
  </technology_stack>

  <implementation_steps>
    <feature_1>
      <title>Backend - Route API /api/get-works</title>
      <description>
        Cr√©er une route GET qui retourne la liste de toutes les ≈ìuvres disponibles avec m√©tadonn√©es.

        Tasks:
        - Ajouter route @app.route("/api/get-works") dans flask_app.py (apr√®s ligne ~1380)
        - Utiliser get_weaviate_client() context manager
        - Query collection "Chunk" pour extraire toutes les ≈ìuvres uniques
        - Parser propri√©t√© nested "work" (work.title, work.author)
        - Compter les chunks par ≈ìuvre (chunks_count)
        - Retourner JSON tri√© par auteur puis titre
        - G√©rer les erreurs de connexion Weaviate
        - Ajouter logging pour debug

        Format de sortie JSON :
        [
          {
            "title": "M√©non",
            "author": "Platon",
            "chunks_count": 127
          },
          ...
        ]
      </description>
      <priority>1</priority>
      <category>backend</category>
      <test_steps>
        1. D√©marrer Weaviate : docker compose up -d
        2. D√©marrer Flask : python flask_app.py
        3. Tester route : curl http://localhost:5000/api/get-works
        4. V√©rifier JSON retourn√© contient toutes les ≈ìuvres
        5. V√©rifier tri alphab√©tique par auteur
        6. V√©rifier chunks_count > 0 pour chaque ≈ìuvre
        7. Tester avec Weaviate arr√™t√© : v√©rifier erreur 500 propre
      </test_steps>
    </feature_1>

    <feature_2>
      <title>Backend - Modification route /chat/send</title>
      <description>
        Modifier la route POST /chat/send pour accepter le param√®tre selected_works et le passer √† la fonction de recherche.

        Tasks:
        - Localiser route @app.route("/chat/send", methods=["POST"]) (ligne ~1756)
        - Ajouter extraction param√®tre selected_works du JSON body
        - Type : List[str] (liste des titres d'≈ìuvres)
        - Valeur par d√©faut : [] (liste vide = toutes les ≈ìuvres)
        - Valider que selected_works est bien une liste
        - Passer selected_works √† la fonction de recherche s√©mantique
        - Logger les ≈ìuvres s√©lectionn√©es pour debug
        - G√©rer cas o√π selected_works = [] (pas de filtre)

        Exemple JSON input :
        {
          "question": "Qu'est-ce que la justice ?",
          "provider": "openai",
          "model": "gpt-4o",
          "limit": 5,
          "selected_works": ["M√©non", "La pens√©e-signe"]
        }
      </description>
      <priority>1</priority>
      <category>backend</category>
      <test_steps>
        1. Modifier /chat/send pour accepter selected_works
        2. Tester POST avec selected_works vide : curl -X POST -H "Content-Type: application/json" -d '{"question":"test","provider":"openai","model":"gpt-4o","selected_works":[]}' http://localhost:5000/chat/send
        3. V√©rifier que la recherche fonctionne sans filtre
        4. Tester POST avec selected_works = ["M√©non"]
        5. V√©rifier que le param√®tre est bien re√ßu (ajouter print/log temporaire)
        6. Tester POST avec selected_works invalide (pas une liste)
        7. V√©rifier gestion d'erreur propre
      </test_steps>
    </feature_2>

    <feature_3>
      <title>Backend - Filtre Weaviate par ≈ìuvres</title>
      <description>
        Impl√©menter la logique de filtrage Weaviate pour rechercher uniquement dans les ≈ìuvres s√©lectionn√©es.

        Tasks:
        - Localiser la fonction de recherche s√©mantique dans /chat/send
        - Identifier les requ√™tes Weaviate (near_text sur Chunk et Summary)
        - Ajouter param√®tre selected_works √† ces fonctions
        - Construire filtre Weaviate si selected_works non vide :
          - Pour Chunk : Filter.by_property("work").by_property("title").contains_any(selected_works)
          - Pour Summary : Idem si Summary a work nested
        - Appliquer filtre dans :
          - Recherche simple (Chunk.query.near_text)
          - Recherche hi√©rarchique (Summary ‚Üí Chunk)
          - Recherche summary uniquement
        - Tester syntaxe filtre Weaviate v4 (contains_any sur nested property)
        - G√©rer cas o√π aucun r√©sultat trouv√© avec filtre
        - Logger requ√™tes Weaviate pour debug

        Note critique : Weaviate v4 syntax pour nested properties
      </description>
      <priority>1</priority>
      <category>backend</category>
      <test_steps>
        1. Identifier fonction de recherche actuelle dans flask_app.py
        2. Ajouter filtre Weaviate pour selected_works
        3. Tester recherche sans filtre (selected_works=[])
        4. V√©rifier r√©sultats de toutes les ≈ìuvres
        5. Tester recherche avec filtre (selected_works=["M√©non"])
        6. V√©rifier que SEULS les chunks de M√©non sont retourn√©s
        7. Tester avec ≈ìuvre inexistante : v√©rifier 0 r√©sultats
        8. Tester mode hi√©rarchique avec filtre
        9. V√©rifier que Summary ET Chunk sont filtr√©s
      </test_steps>
    </feature_3>

    <feature_4>
      <title>Frontend - HTML section filtrage ≈ìuvres</title>
      <description>
        Cr√©er la section HTML "Filtrer par ≈ìuvres" dans la sidebar droite, au-dessus du "Contexte RAG".

        Tasks:
        - Ouvrir templates/chat.html
        - Localiser ligne ~710 (d√©but de .context-sidebar)
        - AVANT la div .context-sidebar, ajouter nouvelle div .works-filter-section
        - Structure HTML :
          - Header avec titre + badge compteur + bouton collapse
          - Content avec boutons "Tout"/"Aucun"
          - Div .works-list (remplie dynamiquement par JS)
        - IDs pour JavaScript :
          - works-filter-section
          - works-filter-content
          - works-collapse-btn
          - works-count-badge
          - works-list
          - select-all-works
          - select-none-works
        - Classe sidebar-empty pour √©tat de chargement
        - Respecter structure HTML existante (sidebar-header, sidebar-content)

        Note : Ne pas modifier la div .context-sidebar existante
      </description>
      <priority>1</priority>
      <category>frontend</category>
      <test_steps>
        1. Ouvrir http://localhost:5000/chat dans le navigateur
        2. V√©rifier que nouvelle section appara√Æt AU-DESSUS du Contexte RAG
        3. V√©rifier header avec titre "üìö Filtrer par ≈ìuvres"
        4. V√©rifier badge compteur visible
        5. V√©rifier bouton collapse (chevron ‚ñº)
        6. V√©rifier boutons "Tout" et "Aucun" pr√©sents
        7. V√©rifier div .works-list vide au d√©marrage
        8. V√©rifier que la section Contexte RAG est toujours visible en-dessous
      </test_steps>
    </feature_4>

    <feature_5>
      <title>Frontend - CSS pour section filtrage</title>
      <description>
        Ajouter les styles CSS pour la section de filtrage par ≈ìuvres, coh√©rents avec le design existant.

        Tasks:
        - Dans templates/chat.html, section &lt;style&gt; (ligne ~6)
        - Ajouter styles pour :
          - .works-filter-section (structure g√©n√©rale)
          - .works-filter-content (max-height 250px, scroll)
          - .works-count-badge (badge compteur)
          - .works-filter-actions (boutons Tout/Aucun)
          - .btn-mini (style boutons)
          - .works-list (liste des ≈ìuvres)
          - .work-item (chaque ≈ìuvre)
          - .work-checkbox (case √† cocher)
          - .work-info (titre + auteur)
          - .work-title, .work-author (typographie)
          - .work-count (badge nombre de passages)
        - Utiliser variables CSS existantes :
          - --color-accent, --color-accent-alt
          - --color-text-main, --color-text-strong
          - --font-body, --font-title
        - Ajouter hover effects
        - Responsive : @media (max-width: 992px) pour mobile
        - Coh√©rence avec .context-sidebar existante

        Note : R√©utiliser les styles de .context-chunk pour coh√©rence
      </description>
      <priority>1</priority>
      <category>frontend</category>
      <test_steps>
        1. Recharger page /chat
        2. V√©rifier styles appliqu√©s sur section filtrage
        3. V√©rifier bordures, border-radius coh√©rents
        4. V√©rifier couleurs coh√©rentes avec palette existante
        5. Tester hover sur boutons "Tout"/"Aucun"
        6. Tester hover sur work-item
        7. V√©rifier scrollbar sur .works-list si >250px
        8. Tester responsive : r√©duire fen√™tre < 992px
        9. V√©rifier que section est collapsible sur mobile
      </test_steps>
    </feature_5>

    <feature_6>
      <title>Frontend - JavaScript √©tat et rendu</title>
      <description>
        Impl√©menter la logique JavaScript pour g√©rer l'√©tat des ≈ìuvres s√©lectionn√©es et le rendu de la liste.

        Tasks:
        - Dans templates/chat.html, section &lt;script&gt; (apr√®s ligne ~732)
        - D√©clarer variables globales :
          - availableWorks: Array&lt;Work&gt; (liste compl√®te)
          - selectedWorks: Array&lt;string&gt; (titres s√©lectionn√©s)
        - Cr√©er fonction loadAvailableWorks() :
          - Fetch GET /api/get-works
          - Stocker dans availableWorks
          - Initialiser selectedWorks (tous par d√©faut ou localStorage)
          - Appeler renderWorksList()
        - Cr√©er fonction renderWorksList() :
          - Vider works-list
          - Pour chaque work, cr√©er HTML :
            - Checkbox (checked si dans selectedWorks)
            - work-info (titre + auteur)
            - work-count (nombre passages)
          - Ajouter event listeners sur checkboxes
          - Click sur work-item toggle checkbox
        - Cr√©er fonction toggleWorkSelection(title, isSelected)
        - Cr√©er fonction updateWorksCount()
        - Appeler loadAvailableWorks() au chargement de la page

        Note : Utiliser addEventListener, pas d'inline onclick
      </description>
      <priority>1</priority>
      <category>frontend</category>
      <test_steps>
        1. Ouvrir console navigateur (F12)
        2. Recharger page /chat
        3. V√©rifier que fetch /api/get-works est appel√© (Network tab)
        4. V√©rifier que availableWorks contient les ≈ìuvres (console.log)
        5. V√©rifier que .works-list contient des work-item
        6. Cocher/d√©cocher une ≈ìuvre
        7. V√©rifier que selectedWorks est mis √† jour (console.log)
        8. V√©rifier que badge compteur est mis √† jour
        9. Cliquer sur work-item (pas la checkbox)
        10. V√©rifier que checkbox est togglee
      </test_steps>
    </feature_6>

    <feature_7>
      <title>Frontend - JavaScript persistance localStorage</title>
      <description>
        Impl√©menter la sauvegarde automatique de la s√©lection dans localStorage pour persister entre les sessions.

        Tasks:
        - Cr√©er fonction saveSelectedWorksToStorage() :
          - localStorage.setItem('selectedWorks', JSON.stringify(selectedWorks))
        - Appeler saveSelectedWorksToStorage() apr√®s chaque modification :
          - Dans toggleWorkSelection()
          - Dans selectAllWorksBtn click
          - Dans selectNoneWorksBtn click
        - Modifier loadAvailableWorks() :
          - Charger localStorage.getItem('selectedWorks')
          - Parser JSON si existe
          - Sinon, s√©lectionner toutes les ≈ìuvres par d√©faut
        - G√©rer cas o√π ≈ìuvres ont chang√© :
          - Filtrer selectedWorks pour ne garder que celles qui existent
          - Mettre √† jour localStorage
        - Ajouter fonction clearWorksStorage() pour debug (optionnel)

        Note : V√©rifier que localStorage est disponible (try-catch)
      </description>
      <priority>2</priority>
      <category>frontend</category>
      <test_steps>
        1. Ouvrir /chat et s√©lectionner 2 ≈ìuvres uniquement
        2. V√©rifier dans DevTools ‚Üí Application ‚Üí Local Storage
        3. V√©rifier cl√© 'selectedWorks' contient JSON des 2 ≈ìuvres
        4. Rafra√Æchir la page (F5)
        5. V√©rifier que les 2 ≈ìuvres sont toujours coch√©es
        6. Cliquer "Tout" puis rafra√Æchir
        7. V√©rifier que toutes les ≈ìuvres sont coch√©es
        8. Cliquer "Aucun" puis rafra√Æchir
        9. V√©rifier qu'aucune ≈ìuvre n'est coch√©e
        10. Tester en navigation priv√©e (pas de localStorage)
      </test_steps>
    </feature_7>

    <feature_8>
      <title>Frontend - JavaScript int√©gration recherche</title>
      <description>
        Modifier la fonction startRAGSearch() pour envoyer les ≈ìuvres s√©lectionn√©es au backend lors de la recherche.

        Tasks:
        - Localiser fonction startRAGSearch(question, provider, model) (ligne ~943)
        - Modifier le fetch POST /chat/send :
          - Ajouter cl√© "selected_works" au JSON body
          - Valeur : selectedWorks (array global)
        - Ajouter validation avant envoi :
          - Si selectedWorks.length === 0, afficher warning ?
          - Ou laisser passer (recherche sur toutes)
        - Tester que le filtre fonctionne :
          - Contexte RAG affich√© ne contient QUE les ≈ìuvres s√©lectionn√©es
          - R√©ponse LLM bas√©e uniquement sur ces ≈ìuvres
        - Ajouter logging console.log pour debug
        - G√©rer erreur si aucun r√©sultat trouv√© avec filtre

        Note : Pas besoin de modifier displayContext() si backend filtre correctement
      </description>
      <priority>1</priority>
      <category>frontend</category>
      <test_steps>
        1. Ouvrir /chat
        2. S√©lectionner uniquement ≈ìuvre "M√©non"
        3. Poser question : "Qu'est-ce que la vertu ?"
        4. V√©rifier dans Network tab : POST /chat/send contient selected_works: ["M√©non"]
        5. V√©rifier que contexte RAG ne contient QUE des chunks de M√©non
        6. V√©rifier que r√©ponse LLM mentionne M√©non (pas d'autres ≈ìuvres)
        7. S√©lectionner 2 ≈ìuvres : "M√©non" + "La pens√©e-signe"
        8. Poser nouvelle question
        9. V√©rifier contexte contient ces 2 ≈ìuvres uniquement
        10. D√©s√©lectionner toutes les ≈ìuvres et tester
      </test_steps>
    </feature_8>

    <feature_9>
      <title>Frontend - Boutons actions et collapse</title>
      <description>
        Impl√©menter les boutons "Tout" / "Aucun" et le comportement de collapse de la section.

        Tasks:
        - Event listener selectAllWorksBtn :
          - selectedWorks = availableWorks.map(w =&gt; w.title)
          - Appeler renderWorksList()
          - Appeler updateWorksCount()
          - Appeler saveSelectedWorksToStorage()
        - Event listener selectNoneWorksBtn :
          - selectedWorks = []
          - Appeler renderWorksList()
          - Appeler updateWorksCount()
          - Appeler saveSelectedWorksToStorage()
        - Event listener worksCollapseBtn :
          - Toggle display de works-filter-content
          - Changer texte chevron (‚ñº / ‚ñ≤)
          - Changer title tooltip ("R√©duire" / "D√©velopper")
          - Optionnel : sauvegarder √©tat collapse dans localStorage
        - Ajouter transition CSS pour collapse smooth

        Note : R√©utiliser logique existante de collapseBtn du Contexte RAG
      </description>
      <priority>2</priority>
      <category>frontend</category>
      <test_steps>
        1. Ouvrir /chat
        2. Cliquer bouton "Tout"
        3. V√©rifier que toutes les ≈ìuvres sont coch√©es
        4. V√©rifier badge compteur : "X/X s√©lectionn√©es"
        5. Cliquer bouton "Aucun"
        6. V√©rifier qu'aucune ≈ìuvre n'est coch√©e
        7. V√©rifier badge compteur : "0/X s√©lectionn√©es"
        8. Cliquer chevron collapse
        9. V√©rifier que .works-filter-content dispara√Æt
        10. V√©rifier chevron change (‚ñº ‚Üí ‚ñ≤)
        11. Recliquer chevron : section r√©appara√Æt
      </test_steps>
    </feature_9>

    <feature_10>
      <title>Frontend - Responsive mobile</title>
      <description>
        Adapter l'interface de filtrage pour les √©crans mobiles (&lt; 992px).

        Tasks:
        - Ajouter @media (max-width: 992px) dans CSS
        - Sur mobile :
          - .works-filter-section : order: -2 (avant contexte RAG)
          - max-height: 200px
          - .works-filter-content : max-height: 150px
          - Section collaps√©e par d√©faut
          - Badge compteur plus visible
        - Tester sur petits √©crans :
          - iPhone (375px)
          - iPad (768px)
          - Desktop r√©duit (900px)
        - V√©rifier que section ne prend pas trop de place
        - V√©rifier scroll horizontal n'appara√Æt pas
        - V√©rifier touch events fonctionnent (pas que click)

        Note : La structure grid actuelle passe d√©j√† en 1 colonne sur mobile
      </description>
      <priority>2</priority>
      <category>frontend</category>
      <test_steps>
        1. Ouvrir DevTools ‚Üí Toggle device toolbar (Ctrl+Shift+M)
        2. S√©lectionner iPhone 12 Pro (390x844)
        3. V√©rifier que section filtrage appara√Æt
        4. V√©rifier hauteur limit√©e √† 200px
        5. V√©rifier scroll fonctionne si liste longue
        6. Tester checkbox touch/click
        7. Tester boutons "Tout"/"Aucun"
        8. Tester collapse fonctionne
        9. Passer en iPad (768px)
        10. V√©rifier layout correct
        11. Revenir desktop (>992px) : v√©rifier layout normal
      </test_steps>
    </feature_10>

    <feature_11>
      <title>Testing - Tests backend routes</title>
      <description>
        Cr√©er tests unitaires pour les nouvelles routes backend et la logique de filtrage.

        Tasks:
        - Cr√©er tests/test_works_filter.py
        - Tester route /api/get-works :
          - Mock get_weaviate_client()
          - Mock collection Chunk avec donn√©es test
          - V√©rifier JSON retourn√© correct
          - V√©rifier tri par auteur
          - V√©rifier chunks_count calcul√©
          - Tester erreur Weaviate
        - Tester /chat/send avec selected_works :
          - Mock fonction de recherche
          - V√©rifier param√®tre pass√© correctement
          - Tester avec selected_works vide
          - Tester avec selected_works = ["M√©non"]
        - Tester logique filtre Weaviate :
          - Mock Weaviate query
          - V√©rifier filtre contains_any appliqu√©
          - V√©rifier r√©sultats filtr√©s
        - Utiliser pytest et pytest-mock
        - V√©rifier couverture >80%

        Note : Ne pas faire d'appels API r√©els en tests
      </description>
      <priority>3</priority>
      <category>testing</category>
      <test_steps>
        1. Installer pytest : pip install pytest pytest-mock
        2. Cr√©er tests/test_works_filter.py
        3. Ex√©cuter : pytest tests/test_works_filter.py -v
        4. V√©rifier tous les tests passent
        5. Ex√©cuter avec coverage : pytest --cov=flask_app tests/test_works_filter.py
        6. V√©rifier couverture >80% pour routes concern√©es
        7. Tester avec Weaviate mock : aucun appel r√©seau r√©el
        8. V√©rifier temps d'ex√©cution <5s
      </test_steps>
    </feature_11>

    <feature_12>
      <title>Testing - Tests frontend JavaScript</title>
      <description>
        Tests manuels de la logique JavaScript dans le navigateur.

        Tasks:
        - Tester loadAvailableWorks() :
          - Console : v√©rifier availableWorks peupl√©
          - V√©rifier selectedWorks initialis√©
        - Tester renderWorksList() :
          - V√©rifier work-items cr√©√©s dynamiquement
          - V√©rifier checkboxes coch√©es selon selectedWorks
        - Tester toggleWorkSelection() :
          - Cocher/d√©cocher plusieurs ≈ìuvres
          - V√©rifier selectedWorks mis √† jour
          - V√©rifier badge compteur synchronis√©
        - Tester localStorage :
          - Modifier s√©lection
          - Rafra√Æchir page
          - V√©rifier persistance
        - Tester int√©gration recherche :
          - S√©lectionner ≈ìuvre
          - Envoyer question
          - V√©rifier filtre appliqu√©
        - Tester boutons Tout/Aucun
        - Tester collapse
        - Tester responsive

        Note : Tests manuels car pas de framework test JS configur√©
      </description>
      <priority>3</priority>
      <category>testing</category>
      <test_steps>
        1. Ouvrir /chat avec DevTools (F12)
        2. Console : taper availableWorks puis Enter
        3. V√©rifier array d'≈ìuvres affich√©
        4. Console : taper selectedWorks puis Enter
        5. V√©rifier array de titres s√©lectionn√©s
        6. Cocher/d√©cocher ≈ìuvre
        7. Retaper selectedWorks : v√©rifier mise √† jour
        8. Application tab ‚Üí Local Storage ‚Üí selectedWorks
        9. V√©rifier JSON synchronis√©
        10. Envoyer question test
        11. Network tab ‚Üí POST /chat/send ‚Üí Preview
        12. V√©rifier selected_works dans payload
      </test_steps>
    </feature_12>

    <feature_13>
      <title>Documentation - Guide utilisateur</title>
      <description>
        Documenter la nouvelle fonctionnalit√© de filtrage par ≈ìuvres.

        Tasks:
        - Mettre √† jour README.md ou cr√©er WORKS_FILTER.md
        - Documenter :
          - Fonctionnalit√© de filtrage
          - Comportement par d√©faut (toutes coch√©es)
          - Boutons "Tout" / "Aucun"
          - Persistance localStorage
          - Impact sur la recherche s√©mantique
          - Cas d'usage recommand√©s
        - Ajouter captures d'√©cran (optionnel)
        - Documenter API /api/get-works
        - Documenter modification /chat/send
        - Ajouter troubleshooting :
          - Que faire si aucune ≈ìuvre affich√©e ?
          - Que faire si filtre ne fonctionne pas ?
          - Comment r√©initialiser la s√©lection ?

        Note : Documentation utilisateur, pas technique
      </description>
      <priority>3</priority>
      <category>documentation</category>
      <test_steps>
        1. Lire README.md ou WORKS_FILTER.md
        2. V√©rifier clart√© des explications
        3. V√©rifier exemples concrets fournis
        4. Tester instructions √©tape par √©tape
        5. V√©rifier troubleshooting couvre cas courants
        6. V√©rifier API document√©e (endpoints, params, retour)
        7. Relire pour fautes orthographe/grammaire
      </test_steps>
    </feature_13>
  </implementation_steps>

  <testing_strategy>
    <backend_tests>
      <structure>
        tests/
        ‚îî‚îÄ‚îÄ test_works_filter.py
      </structure>

      <coverage>
        - Route /api/get-works (mock Weaviate)
        - Route /chat/send avec selected_works (mock recherche)
        - Logique filtre Weaviate (mock query)
        - Cas limites (liste vide, ≈ìuvre inexistante)
      </coverage>
    </backend_tests>

    <frontend_tests>
      <manual_testing>
        - Tests manuels dans navigateur (Chrome, Firefox)
        - Tests console JavaScript
        - Tests localStorage DevTools
        - Tests Network DevTools
        - Tests responsive (DevTools device mode)
      </manual_testing>

      <no_automated_js_tests>
        Pas de framework de test JS (Jest, Mocha) configur√©.
        Tests manuels suffisants pour cette feature.
      </no_automated_js_tests>
    </frontend_tests>
  </testing_strategy>

  <success_criteria>
    <functional>
      - Route /api/get-works retourne toutes les ≈ìuvres avec m√©tadonn√©es
      - Section "Filtrer par ≈ìuvres" visible dans sidebar droite
      - Checkboxes fonctionnelles pour chaque ≈ìuvre
      - S√©lection persiste entre les sessions (localStorage)
      - Recherche filtr√©e uniquement sur ≈ìuvres s√©lectionn√©es
      - Contexte RAG ne contient QUE les ≈ìuvres s√©lectionn√©es
      - Boutons "Tout" / "Aucun" fonctionnels
      - Section collapsible avec chevron
      - Badge compteur synchronis√©
      - Responsive mobile fonctionnel
    </functional>

    <quality>
      - Code backend suit conventions Flask existantes
      - Code frontend suit conventions JavaScript existantes
      - CSS coh√©rent avec design existant (variables CSS)
      - Pas de console errors JavaScript
      - Pas d'erreurs 500 backend
      - Tests backend passent (>80% coverage)
    </quality>

    <performance>
      - /api/get-works r√©pond en <500ms
      - Rendu liste ≈ìuvres <100ms
      - Pas de lag lors du check/uncheck
      - localStorage lecture/√©criture instantan√©e
    </performance>

    <ux>
      - Comportement par d√©faut intuitif (toutes coch√©es)
      - Feedback visuel imm√©diat sur s√©lection
      - Badge compteur toujours √† jour
      - Pas de confusion avec section Contexte RAG
      - Mobile : section accessible et utilisable
    </ux>
  </success_criteria>

  <deployment>
    <no_deployment>
      Modification de l'application Flask existante.
      Pas de d√©ploiement s√©par√© n√©cessaire.

      Red√©marrage Flask apr√®s modifications :
      - Ctrl+C pour arr√™ter
      - python flask_app.py pour red√©marrer
    </no_deployment>
  </deployment>
</project_specification>
